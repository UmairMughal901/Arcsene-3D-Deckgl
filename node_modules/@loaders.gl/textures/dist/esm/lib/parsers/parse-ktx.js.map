{"version":3,"sources":["../../../../src/lib/parsers/parse-ktx.js"],"names":["read","extractMipmapImages","mapVkFormatToWebGL","KTX2_ID","isKTX","data","id","Uint8Array","buffer","byteOffset","length","notKTX","parseKTX","arrayBuffer","uint8Array","ktx","mipMapLevels","Math","max","levels","width","pixelWidth","height","pixelHeight","internalFormat","vkFormat","sizeFunction","level","uncompressedByteLength"],"mappings":"AAAA,SAAQA,IAAR,QAAmB,WAAnB;AACA,SAAQC,mBAAR,QAAkC,gCAAlC;AACA,SAAQC,kBAAR,QAAiC,4BAAjC;AAEA,MAAMC,OAAO,GAAG,CAEd,IAFc,EAER,IAFQ,EAEF,IAFE,EAEI,IAFJ,EAEU,IAFV,EAEgB,IAFhB,EAEsB,IAFtB,EAE4B,IAF5B,EAEkC,IAFlC,EAEwC,IAFxC,EAE8C,IAF9C,EAEoD,IAFpD,CAAhB;AAMA,OAAO,SAASC,KAAT,CAAeC,IAAf,EAAqB;AAC1B,QAAMC,EAAE,GAAG,IAAIC,UAAJ,CAAeF,IAAI,CAACG,MAAL,IAAeH,IAA9B,EAAoCA,IAAI,CAACI,UAAL,IAAmB,CAAvD,EAA0DN,OAAO,CAACO,MAAlE,CAAX;AACA,QAAMC,MAAM,GACVL,EAAE,CAAC,CAAD,CAAF,KAAUH,OAAO,CAAC,CAAD,CAAjB,IACAG,EAAE,CAAC,CAAD,CAAF,KAAUH,OAAO,CAAC,CAAD,CADjB,IAEAG,EAAE,CAAC,CAAD,CAAF,KAAUH,OAAO,CAAC,CAAD,CAFjB,IAGAG,EAAE,CAAC,CAAD,CAAF,KAAUH,OAAO,CAAC,CAAD,CAHjB,IAIAG,EAAE,CAAC,CAAD,CAAF,KAAUH,OAAO,CAAC,CAAD,CAJjB,IAKAG,EAAE,CAAC,CAAD,CAAF,KAAUH,OAAO,CAAC,CAAD,CALjB,IAMAG,EAAE,CAAC,CAAD,CAAF,KAAUH,OAAO,CAAC,CAAD,CANjB,IAOAG,EAAE,CAAC,CAAD,CAAF,KAAUH,OAAO,CAAC,CAAD,CAPjB,IAQAG,EAAE,CAAC,CAAD,CAAF,KAAUH,OAAO,CAAC,CAAD,CARjB,IASAG,EAAE,CAAC,CAAD,CAAF,KAAUH,OAAO,CAAC,CAAD,CATjB,IAUAG,EAAE,CAAC,EAAD,CAAF,KAAWH,OAAO,CAAC,EAAD,CAVlB,IAWAG,EAAE,CAAC,EAAD,CAAF,KAAWH,OAAO,CAAC,EAAD,CAZpB;AAcA,SAAO,CAACQ,MAAR;AACD;AAED,OAAO,SAASC,QAAT,CAAkBC,WAAlB,EAA+B;AACpC,QAAMC,UAAU,GAAG,IAAIP,UAAJ,CAAeM,WAAf,CAAnB;AACA,QAAME,GAAG,GAAGf,IAAI,CAACc,UAAD,CAAhB;AACA,QAAME,YAAY,GAAGC,IAAI,CAACC,GAAL,CAAS,CAAT,EAAYH,GAAG,CAACI,MAAJ,CAAWT,MAAvB,CAArB;AACA,QAAMU,KAAK,GAAGL,GAAG,CAACM,UAAlB;AACA,QAAMC,MAAM,GAAGP,GAAG,CAACQ,WAAnB;AACA,QAAMC,cAAc,GAAGtB,kBAAkB,CAACa,GAAG,CAACU,QAAL,CAAzC;AAEA,SAAOxB,mBAAmB,CAACc,GAAG,CAACI,MAAL,EAAa;AACrCH,IAAAA,YADqC;AAErCI,IAAAA,KAFqC;AAGrCE,IAAAA,MAHqC;AAIrCI,IAAAA,YAAY,EAAGC,KAAD,IAAWA,KAAK,CAACC,sBAJM;AAKrCJ,IAAAA;AALqC,GAAb,CAA1B;AAOD","sourcesContent":["import {read} from 'ktx-parse';\nimport {extractMipmapImages} from '../utils/extract-mipmap-images';\nimport {mapVkFormatToWebGL} from '../utils/ktx-format-helper';\n\nconst KTX2_ID = [\n  // '´', 'K', 'T', 'X', '2', '0', 'ª', '\\r', '\\n', '\\x1A', '\\n'\n  0xab, 0x4b, 0x54, 0x58, 0x20, 0x32, 0x30, 0xbb, 0x0d, 0x0a, 0x1a, 0x0a\n];\n\n// eslint-disable-next-line complexity\nexport function isKTX(data) {\n  const id = new Uint8Array(data.buffer || data, data.byteOffset || 0, KTX2_ID.length);\n  const notKTX =\n    id[0] !== KTX2_ID[0] || // '´'\n    id[1] !== KTX2_ID[1] || // 'K'\n    id[2] !== KTX2_ID[2] || // 'T'\n    id[3] !== KTX2_ID[3] || // 'X'\n    id[4] !== KTX2_ID[4] || // ' '\n    id[5] !== KTX2_ID[5] || // '2'\n    id[6] !== KTX2_ID[6] || // '0'\n    id[7] !== KTX2_ID[7] || // 'ª'\n    id[8] !== KTX2_ID[8] || // '\\r'\n    id[9] !== KTX2_ID[9] || // '\\n'\n    id[10] !== KTX2_ID[10] || // '\\x1A'\n    id[11] !== KTX2_ID[11]; // '\\n'\n\n  return !notKTX;\n}\n\nexport function parseKTX(arrayBuffer) {\n  const uint8Array = new Uint8Array(arrayBuffer);\n  const ktx = read(uint8Array);\n  const mipMapLevels = Math.max(1, ktx.levels.length);\n  const width = ktx.pixelWidth;\n  const height = ktx.pixelHeight;\n  const internalFormat = mapVkFormatToWebGL(ktx.vkFormat);\n\n  return extractMipmapImages(ktx.levels, {\n    mipMapLevels,\n    width,\n    height,\n    sizeFunction: (level) => level.uncompressedByteLength,\n    internalFormat\n  });\n}\n"],"file":"parse-ktx.js"}